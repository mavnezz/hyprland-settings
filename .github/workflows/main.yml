name: Python GTK AppImage

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build-appimage:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: install runtime dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y python3 python3-gi gir1.2-gtk-3.0 libgtk-3-0 libglib2.0-bin

      - name: prepare AppDir
        run: |
          mkdir -p AppDir/usr/bin
          cp ml4w-hyprland AppDir/usr/bin/
          chmod +x AppDir/usr/bin/ml4w-hyprland

          # Desktop file & icon
          mkdir -p AppDir/usr/share/applications
          mkdir -p AppDir/usr/share/icons/hicolor/256x256/apps
          cp com.ml4w.hyprlandsettings.desktop AppDir/usr/share/applications/
          cp resources/logo.png AppDir/usr/share/icons/hicolor/256x256/apps/com.ml4w.hyprlandsettings.png

      - name: build AppImage
        uses: AppImageCrafters/build-appimage-action@master
        with:
          recipe: AppImageBuilder.yml

      - name: upload AppImage
        uses: actions/upload-artifact@v4
        with:
          name: hyprland-settings-appimage
          path: ./*.AppImage
